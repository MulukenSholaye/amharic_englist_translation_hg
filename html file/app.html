<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Code Executor</title>
    <!-- Use Tailwind CSS for a clean, modern, and responsive design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for the code editor and output area */
        #code-editor, #output {
            @apply p-4 rounded-lg shadow-inner border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors;
        }
        #code-editor {
            min-height: 400px;
            font-family: monospace;
            white-space: pre;
            overflow-wrap: normal;
            overflow-x: auto;
        }
        #output {
            background-color: #f1f5f9; /* Slate 100 */
            min-height: 200px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body class="bg-gray-100 p-8">

    <div class="max-w-7xl mx-auto space-y-6">
        <header class="text-center">
            <h1 class="text-4xl font-bold text-gray-800">Python Code Executor</h1>
            <p class="mt-2 text-lg text-gray-600">Write Python code and see the output instantly. No server required!</p>
        </header>
    
        <!-- Main application container with a side-by-side layout -->
        <div class="flex flex-col lg:flex-row space-y-6 lg:space-y-0 lg:space-x-6">
            <!-- Code Editor Section -->
            <div class="flex-1 bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">Enter Python Code</h2>
                <textarea id="code-editor" class="w-full text-gray-800" placeholder="print('Hello, Pyodide!')">print("Hello from Pyodide!")

# Example: calculate factorial
def factorial(n):
    if n == 0:
        return 1
    else:
        return n * factorial(n-1)

print(f"The factorial of 5 is: {factorial(5)}")

# Example: import a library
# from pyodide.http import pyfetch
# response = await pyfetch("https://pyodide.org/en/stable/versions/pyodide-0.24.1.json")
# print(await response.json())
                </textarea>
                <button id="run-button" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                    Run Code
                </button>
            </div>
    
            <!-- Output Console Section -->
            <div class="flex-1 bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">Output</h2>
                <pre id="output" class="w-full text-gray-800"></pre>
                <div id="loading" class="mt-4 hidden text-center text-blue-500 font-medium">
                    <span class="animate-pulse">Executing code...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Pyodide and execution logic -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>
    <script>
        // Get references to DOM elements
        const codeEditor = document.getElementById('code-editor');
        const runButton = document.getElementById('run-button');
        const output = document.getElementById('output');
        const loadingIndicator = document.getElementById('loading');
        
        // Asynchronous function to load Pyodide and run the code
        async function runPython() {
            // Display loading indicator and disable the button
            loadingIndicator.classList.remove('hidden');
            runButton.disabled = true;
            output.textContent = ''; // Clear previous output
            
            try {
                // Initialize Pyodide on first run
                if (!window.pyodide) {
                    output.textContent = 'Loading Python environment...';
                    window.pyodide = await loadPyodide();
                    output.textContent = 'Python environment loaded. Ready to run.';
                }
                
                // Get the Python code from the textarea
                const pythonCode = codeEditor.value;

                // A more robust way to capture stdout is to redirect it to an in-memory buffer
                // and then retrieve the buffer's value. This avoids common timing errors.
                const codeToExecute = `
                    import sys
                    import io
                    sys.stdout = io.StringIO()
                    
                    ${pythonCode}
                    
                    sys.stdout.getvalue()
                `;

                // Execute the Python code and get the returned value (the captured stdout)
                const capturedOutput = await window.pyodide.runPythonAsync(codeToExecute);
                
                // Display the captured output
                output.textContent = capturedOutput;
                
            } catch (err) {
                // Display any errors that occurred during execution
                output.textContent = `Error:\n${err}`;
                console.error(err);
            } finally {
                // Hide loading indicator and re-enable the button
                loadingIndicator.classList.add('hidden');
                runButton.disabled = false;
            }
        }
        
        // Add event listener to the "Run" button
        runButton.addEventListener('click', runPython);

        // Pre-load Pyodide when the page loads
        document.addEventListener('DOMContentLoaded', async () => {
            await runPython();
        });
    </script>

</body>
</html>

